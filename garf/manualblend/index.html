<head>
  <style>
    .panel {
      width: 250px;
      height: 216px;
      object-fit: cover;
    }
    .left {
      object-position: -1%;
    }
    .middle {
      object-position: unset;
    }
    .right {
      object-position: 102%;
    }

    .strip {
      display: flex;
    }
  </style>
</head>

<body id="body">
  <div class="strip">
    <a id="link0" target="_blank"><img class="panel" id="panel0"></img></a>
    <a id="link1" target="_blank"><img class="panel" id="panel1"></img></a>
    <a id="link2" target="_blank"><img class="panel" id="panel2"></img></a>
  </div>
  <a id="permalink">Link to strip</a>
  <script>
    randomDate = function () {
      do {
        var date = new Date(+Date.parse("1978-06-19") + Math.random() * (Date.now() - Date.parse("1978-06-19")));
      } while (date.getDay() == 0);
      var datestring = date.getFullYear().toString().slice(2) + ("0" + (date.getMonth() + 1)).slice(-2) + ("0" + date.getDate()).slice(-2);
      return datestring;
    }
    getDate = function () {
      date = urlParams.get('d');
      return date;
    }
    getSpecial = function (n){
      p = urlParams.get(`p${n}`);
      return p;
    }
    setPanel = function(d, n0, n1){
      ar = d.slice(0,2);
      if (ar < 78) year = "20"+ar; else year = "19" + ar;
      url = `http://picayune.uclick.com/comics/ga/${year}/ga${d}.gif`;
      document.getElementById(`panel${n1}`).src = url;
      document.getElementById(`link${n1}`).href = url;
      if (n0 == 0) document.getElementById(`panel${n1}`).classList.add("left");
      if (n0 == 1) document.getElementById(`panel${n1}`).classList.add("middle");
      if (n0 == 2) document.getElementById(`panel${n1}`).classList.add("right");
    }
    resolvePanel = function(n1){
      special = getSpecial(n1);
      if (special == null) {
        n0 = n1;
        d = getDate();
        if (d == "random") d = randoms[0];
      }
      else if (special == 'random'){
        n0 = n1;
        d = randoms[n1+1];
      }
      else if (special == 'superrandom'){
        n0 = Math.floor(Math.random()*4);
        d = randoms[n1+1];
      }
      else if (special == 'blender'){
        n0 = 0;
        d = '080426';
      }
      else{
        n0 = special.split('-')[1];
        if (n0 == undefined) n0 = n1;
        d = special.split('-')[0];
      }

      setPanel(d, n0, n1);
    }
    generateLink = function (){
      ['d', 'p0', 'p1', 'p2'].forEach(function(param, index){
        if (urlParams.has(param)){
          value = urlParams.get(param);
          if (value.includes('random')) value = randoms[index];
          linkParams.push(`${param}=${value}`);
        }
      });
      document.getElementById('permalink').href = `?${linkParams.join('&')}`;
    }
    window.onload = function () {
      urlParams = new URLSearchParams(window.location.search);
      if (!urlParams.has('d')) window.location = `?d=random`;
      randoms = [randomDate(),randomDate(),randomDate(),randomDate()];
      linkParams = [];
      resolvePanel(0);
      resolvePanel(1);
      resolvePanel(2);
      generateLink();
    }
  </script>
</body>
